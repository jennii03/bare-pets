{%liquid
    assign heading = section.settings.heading
    assign menu = section.settings.menu
    assign blog_handles = section.settings.blog_handles
    assign enable_recent = section.settings.enable_recent
    assign recent = section.settings.recent
    assign blog = section.settings.blog
%}

<div id="module-blog-cat-{{ section.id }}" class="module-blog-cat">
    <div class="module-blog-cat__wrapper">
        <div class="module-blog-cat__container d-flex">
            <div class="module-blog-cat__filter-container">
                <form class="search" action="/search">
                    <input type="text" placeholder="Search" name="q" value="{{ search.terms | escape }}"  />
                    <input type="submit" value="Search" />
                </form>
                <h2 class="module-blog-cat__heading remove-spacing">{{ heading }}</h2>
                
                {%- if menu != blank -%}
                    <ul class="module-blog-cat__menu list-unstyled">
                      {%- for link in menu.links -%}
                        <li>
                          <a href="{{ link.url }}" class="module-blog-cat__menu-item">
                            {{ link.title }}
                          </a>
                        </li>
                      {%- endfor -%}
                    </ul>
                {%- endif -%}

                {% if enable_recent %}
                    <h2 class="module-blog-cat__recent remove-spacing">{{ recent }}</h2>
                    <div class="module-blog-cat__recents">
                        {% assign recent = blog | split: "," %}

                        {% for handle in recent %}
                            {% for article in blogs[handle].articles %}
                                <div class="module-blog-cat__recent-item">
                                    <div class="module-blog-cat__recent-image">
                                        <img src="{{ article.image | image_url }}">
                                    </div>
                                    <div class="module-blog-cat__recent-info">
                                        <p class="module-blog-cat__recent-content remove-spacing">{{ article.content | truncatewords: 8 }}</p>
                                    </div>
                                </div>
                            {% endfor %}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            <div class="module-blog-cat__blog-container">
                {% if blog_handles != blank %}
                    {% assign blog_handles = blog_handles | split: "," %}
                {% else %}
                {% assign blog_handless = blog.handle %}
                    {% assign blog_handles = blog_handless | split: "," %}
                {% endif %}
                {%- paginate blogs[handle].articles by 9 -%}
                {% for handle in blog_handles %}
                    {% for article in blogs[handle].articles %}
                        <div class="module-blog-cat__blog-lists">
                            <div class="module-blog-cat__blog-item">
                                <div class="module-blog-cat__infos">
                                    <div class="module-blog-cat__blog-image">
                                        <img src="{{ article.image | image_url }}">
                                        <p class="module-blog-cat__blog-category remove-spacing">{{ article.handle | split: "/" | first }}</p>
                                    </div>
                                    <div class="module-blog-cat__blog-info">
                                        <h2 class="module-blog-cat__blog-title remove-spacing">{{ article.title }}</h2>
                                        <p class="module-blog-cat__blog-date remove-spacing">{{ article.published_at | date: "%B %d, %Y" }}</p>
                                        <p class="module-blog-cat__blog-content remove-spacing">{{ article.content | truncatewords: 15 }}</p>
                                    </div>
                                </div>
                                <div class="module-blog-cat__blog-linking">
                                    <p class="module-blog-cat__blog-link remove-spacing"><a href="{{ article.url }}">READ FULL ARTICLE</a></p>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% endfor %}
                {%- endpaginate -%}
                {%- paginate blogs[handle].articles by 9 -%}
                {{ paginate | default_pagination: next_label: 'Older', previous_label: 'Newer' }}
                {%- endpaginate -%}
            </div>
        </div>
    </div>
</div>

<style>
    .module-blog-cat__wrapper {
        padding: 70px 30px;
    }
    .module-blog-cat__container {
        max-width: 1280px;
        margin: auto;
        gap: 50px;
    }
    .module-blog-cat__filter-container {
        width: 20%;
    }
    .module-blog-cat__blog-container {
        width: 80%;
    }
    .module-blog-cat__blog-image img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 10px 10px 0 0;
    }
    .module-blog-cat__blog-image {
        position: relative
    }
    .module-blog-cat__blog-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
    }
    .module-blog-cat__blog-lists {
        width: calc(33.33% - 14px);
    }
    .module-blog-cat__blog-category {
        font-size: 12px;
        line-height: 21px;
        font-family: var(--futurabold);
        text-transform: uppercase;
        color: #6bc5b1;
        background: #fff;
        padding: 7px 15px;
        border-radius: 50px;
        position: absolute;
        top: 15px;
        left: 15px;
    }
    .module-blog-cat__blog-info p:last-child {
        color: #2a294f;
        font-size: 14px;
        line-height: 18px;
        font-family: var(--gilroyreg);
        margin: 0;
    }
    .module-blog-cat__blog-title {
        font-size: 28px;
        line-height: 32px;
        text-transform: lowercase;
        font-family: var(--gilroybold);
        color: #2a294f;
    }
    .module-blog-cat__blog-date {
        font-size: 12px;
        line-height: 18px;
        text-transform: uppercase;
        font-family: var(--gilroybold);
        color: #909e9d;
        letter-spacing: 1.5px;
        margin: 10px 0;
    }
    .module-blog-cat__blog-link a {
        font-size: 12px;
        line-height: 21px;
        font-family: var(--futurabold);
        color: #6bc5b1;
    }
    .module-blog-cat__blog-item {
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        border: solid 1px #909e9d;
        border-radius: 18px;
    }
    .module-blog-cat__blog-info {
        padding: 0 20px;
    }
    .module-blog-cat__blog-linking {
        padding: 20px;
    }
    .module-blog-cat__menu-item {
        font-family: var(--gilroyreg);
        font-size: 14px;
        line-height: 40px;
        color: #2a294f;
        text-decoration: none;
    }
    .module-blog-cat__menu li {
        border-bottom: solid 1px #9f9fbf;
    }
    .module-blog-cat__heading, .module-blog-cat__recent {
        font-size: 18px;
        line-height: 21px;
        font-family: var(--futurabold);
        color: #6bc5b1;
    }
    .module-blog-cat__recent {
        margin-top: 40px;
        margin-bottom: 10px;
    }
    .module-blog-cat__recent-item {
        display: flex;
        gap: 20px;
    }
    .module-blog-cat__recent-image img {
        width: 90px;
        height: 70px;
        object-fit: cover;
    }
    .module-blog-cat__recent-info p {
        font-family: var(--gilroyreg);
        font-size: 12px;
        line-height: 16px;
        margin: 0;
    }
    @media (max-width: 1024px) {
        .module-blog-cat__blog-lists {
            width: calc(50% - 14px);
        }
    }
    @media (max-width: 767px) {
        .module-blog-cat__filter-container, .module-blog-cat__blog-container {
            width: 100%;
        }
        .module-blog-cat__blog-lists {
            width: 100%;
        }
        .module-blog-cat__container {
            flex-direction: column;
        }
        .module-blog-cat__recent, .module-blog-cat__recents {
            display: none;
        }
    }
</style>

{% schema %}
  {
    "name": "Module Blog Categories",
    "class": "module",
    "settings": [
        {
            "type": "text",
            "id": "heading",
            "label": "Heading",
            "default": "CATEGORY"
        },
        {
            "type": "link_list",
            "id": "menu",
            "label": "Menu"
        },
        {
            "type": "text",
            "id": "blog_handles",
            "label": "Blog Handles",
            "info": "separate handles with comma (,). leave blank if it will be used on individual blog pages"
        },
        {
            "type": "checkbox",
            "id": "enable_recent",
            "label": "Enable Recent Blogs?",
            "default": true
        },
        {
            "type": "text",
            "id": "recent",
            "label": "Heading",
            "default": "RECENT"
        },
        {
            "type": "blog",
            "id": "blog",
            "label": "Blog to feature"
        }
    ],
    "presets": [
      {
        "name": "Module Blog Categories",
        "category": "blogs"
      }
    ]
  }
{% endschema %}